rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Allow all operations for authenticated users during development
    // TODO: Tighten these rules for production!
    
    // Appointments - Only dietitian can access their own appointments
    match /appointments/{appointmentId} {
      allow read, write: if request.auth != null;
      // For testing without auth:
      allow read, write: if true;
    }
    
    // Clients - Only dietitian can access their own clients
    match /clients/{clientId} {
      allow read, write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Recipes - Global ones readable by all, own recipes by owner
    match /recipes/{recipeId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Diet Templates
    match /dietTemplates/{templateId} {
      allow read, write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Packages
    match /packages/{packageId} {
      allow read, write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Notes
    match /notes/{noteId} {
      allow read, write: if request.auth != null;
      allow read, write: if true;
    }
    
    // Users - existing collection
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId;
    }
    
    // Chats - existing collection
    match /chats/{chatId} {
      allow read, write: if request.auth != null;
      
      match /messages/{messageId} {
        allow read, write: if request.auth != null;
      }
    }
  }
}
